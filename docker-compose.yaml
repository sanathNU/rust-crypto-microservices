version: '3.8'

services:
  lattice-service:
    build:
      context: .
      dockerfile: Dockerfile.lattice
    ports:
      - "8000:8000"
    environment:
      - RUST_LOG=info

  zk-service:
    build:
      context: .
      dockerfile: Dockerfile.zk
    ports:
      - "8001:8001"
    environment:
      - RUST_LOG=info

  bench-client:
    build:
      context: .
      dockerfile: Dockerfile.bench
    depends_on:
      - lattice-service
      - zk-service
    command: >
      suite
      --lattice-url http://lattice-service:8000
      --zk-url http://zk-service:8001
      --label docker-local
    profiles:
      - benchmark